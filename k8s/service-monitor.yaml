# =============================================================================
# Shakwa Backend - ServiceMonitor (Prometheus Operator)
# =============================================================================
# DISABLED FOR LOCAL DEVELOPMENT
# Requires Prometheus Operator CRDs to be installed
#
# To enable monitoring, install Prometheus Operator first:
# helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
# helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring --create-namespace
# =============================================================================

# apiVersion: monitoring.coreos.com/v1
# kind: ServiceMonitor
# metadata:
#   name: shakwa-backend-monitor
#   namespace: shakwa
#   labels:
#     app.kubernetes.io/name: shakwa-backend
#     app.kubernetes.io/component: monitoring
#     app.kubernetes.io/part-of: shakwa-platform
#     release: prometheus
#   annotations:
#     description: "Prometheus ServiceMonitor for Shakwa Backend"
# spec:
#   selector:
#     matchLabels:
#       app.kubernetes.io/name: shakwa-backend
#   namespaceSelector:
#     matchNames:
#       - shakwa
#   endpoints:
#     - port: http
#       path: /api/metrics
#       interval: 30s
#       scrapeTimeout: 10s
#       scheme: http
#       honorLabels: true
#       relabelings:
#         - sourceLabels: [__meta_kubernetes_pod_name]
#           targetLabel: pod
#         - sourceLabels: [__meta_kubernetes_namespace]
#           targetLabel: namespace
#         - sourceLabels: [__meta_kubernetes_service_name]
#           targetLabel: service

# ---
# apiVersion: monitoring.coreos.com/v1
# kind: PrometheusRule
# metadata:
#   name: shakwa-backend-alerts
#   namespace: shakwa
#   labels:
#     app.kubernetes.io/name: shakwa-backend
#     app.kubernetes.io/component: alerting
#     app.kubernetes.io/part-of: shakwa-platform
#     release: prometheus
#   annotations:
#     description: "Prometheus alerting rules for Shakwa Backend"
# spec:
#   groups:
#     - name: shakwa-backend.rules
#       rules:
#         - alert: ShakwaHighErrorRate
#           expr: |
#             sum(rate(http_requests_total{namespace="shakwa", status=~"5.."}[5m]))
#             /
#             sum(rate(http_requests_total{namespace="shakwa"}[5m])) > 0.05
#           for: 5m
#           labels:
#             severity: critical
#             service: shakwa-backend
#           annotations:
#             summary: "High error rate detected in Shakwa Backend"
#             description: "Error rate is above 5% for the last 5 minutes"
