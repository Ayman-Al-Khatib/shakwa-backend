# =============================================================================
# Shakwa Backend - Resource Quota
# =============================================================================
# Limits total resource consumption in the namespace
# Prevents excessive resource usage and ensures fair distribution
#
# Important notes:
# - Ensure quotas are sufficient for the required number of replicas
# - With 3 replicas and 1Gi memory per pod, you need at least 3Gi
# - Leave headroom for HPA scaling
#
# To check quota usage:
# kubectl describe resourcequota -n shakwa
#
# Warning: If quota is exceeded, new pods will not be created
# =============================================================================

apiVersion: v1
kind: ResourceQuota
metadata:
  name: shakwa-resource-quota
  namespace: shakwa
  labels:
    app.kubernetes.io/name: shakwa
    app.kubernetes.io/component: resource-management
    app.kubernetes.io/part-of: shakwa-platform
  annotations:
    description: 'Resource quota for Shakwa namespace'
spec:
  hard:
    # ===========================================
    # Compute Resources
    # ===========================================
    # Total CPU requests across all pods
    requests.cpu: '8'
    # Total CPU limits across all pods
    limits.cpu: '16'

    # Total memory requests across all pods
    requests.memory: '8Gi'
    # Total memory limits across all pods
    limits.memory: '16Gi'

    # ===========================================
    # Storage Resources
    # ===========================================
    # Total persistent volume claims
    persistentvolumeclaims: '5'
    # Total storage requested
    requests.storage: '50Gi'

    # ===========================================
    # Object Count Limits
    # ===========================================
    # Maximum number of pods
    pods: '20'
    # Maximum number of services
    services: '10'
    # Maximum number of secrets
    secrets: '20'
    # Maximum number of configmaps
    configmaps: '20'
    # Maximum number of replication controllers
    replicationcontrollers: '5'

    # ===========================================
    # Service Type Limits
    # ===========================================
    # Limit LoadBalancer services (cost control)
    services.loadbalancers: '0'
    # Limit NodePort services
    services.nodeports: '2'
