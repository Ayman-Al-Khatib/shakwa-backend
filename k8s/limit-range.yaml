# =============================================================================
# Shakwa Backend - Limit Range
# =============================================================================
# Sets default and limit values for container resources
# Ensures all pods have resource constraints
#
# Benefits:
# - Prevent unlimited resource consumption
# - Ensure appropriate QoS for pods
# - Automatically apply resource policies
#
# Note: These values apply to containers that don't specify resources
# Containers that explicitly specify resources override these values
#
# To verify LimitRange:
# kubectl describe limitrange -n shakwa
# =============================================================================

apiVersion: v1
kind: LimitRange
metadata:
  name: shakwa-limit-range
  namespace: shakwa
  labels:
    app.kubernetes.io/name: shakwa
    app.kubernetes.io/component: resource-management
    app.kubernetes.io/part-of: shakwa-platform
  annotations:
    description: 'Default resource limits for Shakwa namespace'
spec:
  limits:
    # ===========================================
    # Container Limits
    # ===========================================
    - type: Container
      # Default values if not specified
      default:
        cpu: '400m'
        memory: '512Mi'
      # Default requests if not specified
      defaultRequest:
        cpu: '100m'
        memory: '128Mi'
      # Maximum allowed
      max:
        cpu: '2'
        memory: '2Gi'
      # Minimum allowed
      min:
        cpu: '50m'
        memory: '64Mi'
      # Max ratio of limit to request
      maxLimitRequestRatio:
        cpu: '4'
        memory: '4'

    # ===========================================
    # Pod Limits
    # ===========================================
    - type: Pod
      max:
        cpu: '4'
        memory: '4Gi'
      min:
        cpu: '50m'
        memory: '64Mi'

    # ===========================================
    # PVC Limits
    # ===========================================
    - type: PersistentVolumeClaim
      max:
        storage: '20Gi'
      min:
        storage: '1Gi'
